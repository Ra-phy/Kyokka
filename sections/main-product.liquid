<section>

  <div class="py-20 px-10 w-[90vw] mx-auto">
    <div class="flex gap-10 items-start">

      <div class="w-1/2 hidden md:block sticky top-5">
       <div class="space-y-10">
          {% for media in product.media %}
           {% case media.media_type %}
                {% when "image" %}
                <img
                  src="{{ media |  image_url: width: 900 }}"
                  alt=""
                  height=""
                  width=""
                  class="w-200 rounded-md inline-block">

              {% endcase %}
          {% endfor %}
        </div>
        
      </div>
      <div class="md:hidden">mobile view</div>


      <div class="w-1/2 sticky top-5">

        {% form 'product'
          , product %}

          <input
            type="hidden"
            name="id"
            value="{{ product.selected_or_first_available_variant.id }}"
            id="id">

          <div class="header-font text-7xl">{{ product.title }}</div>
          <div>
            <div>
              <span class="text-xl">{{ product.vendor }}</span>
            </div>
            <div class="my-8 text-4xl font-semibold header-font">
              <span class="space-x-3 line-through">{{ product.selected_or_first_available_variant.compare_at_price | money }}</span>
              <span>{{ product.selected_or_first_available_variant.price | money }}</span>
            </div>
          </div>

          <!-- VARIANT SELECTOR -->
          <div class="">
            {% unless product.has_only_default_variant %}
              {% for option in product.options_with_values %}
                <div class="mb-10">
                  <h4 class="mb-2 font-semibold text-gray-500">
                    {{ option.name }}
                  </h4>
                  {% assign index = forloop.index %}
                  
                    
                      {% for value in option.values %}
                        
                        <div class="variant-option relative mr-2 inline-block">
                          <input
                          type="radio"
                          name="option-{{ index }}-{{option.name}}"
                          id="option-{{ index }}"
                          value="{{ value }}"
                          data-index="option-{{ index }}"
                          class="variant-radio absolute top-0 left-0 opacity-0 w-[100%] h-[100%] z-10  cursor-pointer"
                          {% if forloop.index == 1 %}
                          checked
                          {% endif %}>
                          <label for="option-{{ index }}" class="inline-block w-[100%] h-[100%] px-5 py-3 rounded-full border border-[var(--btn-primary)] text-[var(--btn-primary)] pointer-events-none duration-100">{{value}}</label>                 
                        </div>
                      {% endfor %}
                    
                  
                </div>


              {% endfor %}
            {% endunless %}
          </div>


          <div class="product-info space-y-8">
            {% for block in section.blocks %}
              {% render block %}
            {% endfor %}
          </div>

          <!-- QUANTITY SELECTOR -->
          <div class="my-5 inline-block">

            <div class="flex justify-center items-center px-5 py-5 border border-gray-300 rounded-md overflow-hidden">
              <div class="qty-minus flex items-center px-2 py-1  cursor-pointer">
                {% render "icon-minus" %}
              </div>

              <input
                class="qty-input w-30 border-none focus:outline-none rounded-md text-center"
                type="number"
                value="1"
                min="1"
                id="quantity">

              <div class="qty-plus flex items-center px-2 py-1  cursor-pointer ">
                {% render "icon-plus" %}
              </div>
            </div>
          </div>

          <!-- ADD TO CART -->
          <div>
            <button type="button" id="addToCart" class="inline-block w-full text-center text-white rounded-lg product-card bg-[var(--btn-primary)] hover:bg-[var(--btn-primary-hover)] active:bg-[var(--btn-primary-active)]  duration-300 btn-solid">
              {% if product.selected_or_first_available_variant == false %}
                {{ "general.product.disable" | t }}
              {% endif %}
              {% if product.selected_or_first_available_variant == false %}
                {{ "general.product.sold_out" | t }}
              {% else %}
                {{ "general.product.add_to_cart" | t }}
              {% endif %}
            </button>
          </div>

        {% endform %}
      </div>
    </div>
  </div>
  <!-- SUCCESS MESSAGE POPUP -->
<div id="cartSuccessMsg" class="hidden fixed top-30 right-10 bg-[var(--btn-primary)] text-white px-6 py-3 rounded-2xl shadow-lg z-50 transition-all duration-300 opacity-0">
</div>


</section>
<script>
  window.product = {{ product | json }}

  const getSelectedOptions = function(){
    let options= [];
    const optionsGroup = document.querySelectorAll(".variant-option input:checked");
    optionsGroup.forEach((input)=> {
      options.push(input.value)
    })

    return options;
    
  }
  getSelectedOptions();
  console.log(window.product.variants);

  const getVariantID = function (selectedOptions) {
  const productVariants = window.product.variants;

  for (const variant of productVariants) {
    if (
      selectedOptions[0] === variant.option1 &&
      (selectedOptions[1] ? selectedOptions[1] === variant.option2 : true) &&
      (selectedOptions[2] ? selectedOptions[2] === variant.option3 : true)
    ) {
      return variant.id;
    }
  }

  return null;
};

console.log(getVariantID(getSelectedOptions()));

document.querySelectorAll(".variant-radio").forEach((radioInput)=>{
  radioInput.addEventListener("change",function(){
    const selectedOptions = getSelectedOptions();
    const variantID = getVariantID(selectedOptions);
    console.log("ID:", variantID);

     if (variantID) {
      document.getElementById("id").value = variantID;
    }

  })
})  


  document.addEventListener("DOMContentLoaded", () => {
  const adcButton = document.getElementById("addToCart");

  adcButton.addEventListener("click", function () {
    let variantID = document.getElementById("id").value;
    let quantity = document.getElementById("quantity").value;
    let formData = {
      items: [
        {
          id: variantID,
          quantity: quantity,
        },
      ],
    };

    fetch(window.Shopify.routes.root + "cart/add.js", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify(formData),
    })
      .then((response) => {
        console.log(response.json());

        // Show success message
        const successMsg = document.getElementById("cartSuccessMsg");
        if (successMsg) {
          successMsg.textContent = `âœ… Added ${quantity} item(s) to your cart!`;
          successMsg.classList.remove("hidden");
          successMsg.classList.add("opacity-100");

          // Hide after 3 seconds
          setTimeout(() => {
            successMsg.classList.remove("opacity-100");
            successMsg.classList.add("opacity-0");
            setTimeout(() => successMsg.classList.add("hidden"), 500);
          }, 3000);
        }

      })
      .catch((error) => {
        console.error("Error:", error);
      });
  });
});


//QUANTITY SELECTOR
document.addEventListener("DOMContentLoaded", function () {
  const minusBtn = document.querySelector(".qty-minus");
  const plusBtn = document.querySelector(".qty-plus");
  const qtyInput = document.querySelector(".qty-input");

  if (minusBtn && plusBtn && qtyInput) {
    plusBtn.addEventListener("click", () => {
      qtyInput.value = parseInt(qtyInput.value || 1) + 1;
    });

    minusBtn.addEventListener("click", () => {
      let current = parseInt(qtyInput.value || 1);
      if (current > 1) {
        qtyInput.value = current - 1;
      }
    });
  }
});

</script>
{% schema %}
  {
    "name": "Product",
    "blocks": [
      {
        "type": "@app"
      }
    ],
    "settings": []
  }
{% endschema %}